<div>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-unit);">
    <h1>quotes</h1>
    <button (click)="onNewQuoteClick()">+ new quote</button>
  </div>

  <fieldset>
    <legend>search & filters</legend>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-unit); margin-bottom: var(--space-unit);">
      <div>
        search:
        <input type="text" [ngModel]="filters().search" (ngModelChange)="onSearchInputChange($event)"
          placeholder="quote number, supplier...">
      </div>

      <div>
        status:
        <select [ngModel]="filters().status" (ngModelChange)="onStatusInputChange($event)">
          <option value="">all statuses</option>
          @for (status of statuses(); track status) {
          <option [value]="status">{{ status.toLowerCase() }}</option>
          }
        </select>
      </div>

      <div>
        rfq id:
        <input type="number" [ngModel]="filters().rfqId" (ngModelChange)="onRfqIdInputChange($event)"
          placeholder="rfq id...">
      </div>

      <div>
        supplier id:
        <input type="number" [ngModel]="filters().supplierId" (ngModelChange)="onSupplierIdInputChange($event)"
          placeholder="supplier id...">
      </div>

      <div>
        from date:
        <input type="date" [ngModel]="filters().fromDate" (ngModelChange)="onFromDateInputChange($event)">
      </div>

      <div>
        to date:
        <input type="date" [ngModel]="filters().toDate" (ngModelChange)="onToDateInputChange($event)">
      </div>
    </div>

    <button (click)="clearFilters()">clear filters</button>
  </fieldset>

  @if (loading()) {
  <div style="text-align: center; padding: var(--space-unit);">
    loading quotes...
  </div>
  }

  @if (error()) {
  <div style="border: var(--border-width) solid rgb(var(--color-accent)); padding: var(--space-unit);">
    error: {{ error() }}
  </div>
  }

  @if (!loading() && !error()) {
  <div class="data-grid">
    <ag-grid-angular [rowData]="quotes()" [columnDefs]="columnDefs" [defaultColDef]="defaultColDef" [theme]="gridTheme"
      [rowSelection]="'single'" [animateRows]="true" [domLayout]="'normal'" (gridReady)="onGridReady($event)"
      (rowClicked)="onRowClicked($event)" (cellValueChanged)="onCellValueChanged($event)" style="height: 600px; width: 100%;">
    </ag-grid-angular>
  </div>

  <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--space-unit);">
    <p>showing {{ (currentPage() - 1) * pageSize() + 1 }} to {{ Math.min(currentPage() * pageSize(), totalCount()) }} of {{ totalCount() }} results</p>
    <div>
      <button (click)="onPageChange(currentPage() - 1)" [disabled]="!hasPrevPage()">← prev</button>
      @for (page of getPageNumbers(); track page) {
      <button (click)="onPageChange(page)" [style.text-decoration]="page === currentPage() ? 'underline' : 'none'">{{ page }}</button>
      }
      <button (click)="onPageChange(currentPage() + 1)" [disabled]="!hasNextPage()">next →</button>
    </div>
  </div>
  }
</div>
