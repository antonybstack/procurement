<div>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-unit);">
    <h1>requests</h1>
    <button (click)="onNewRfqClick()">+ new request</button>
  </div>

  <fieldset>
    <legend>search & filters</legend>
    <div
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-unit); margin-bottom: var(--space-unit);">
      <div>
        search:
        <input (ngModelChange)="onSearchInputChange($event)" [ngModel]="filters().search" placeholder="rfq number, title..."
               type="text">
      </div>

      <div>
        status:
        <select (ngModelChange)="onStatusInputChange($event)" [ngModel]="filters().status">
          <option value="">all statuses</option>
          <option value="Draft">draft</option>
          <option value="Open">open</option>
          <option value="Closed">closed</option>
          <option value="Awarded">awarded</option>
        </select>
      </div>

      <div>
        from date:
        <input (ngModelChange)="onFromDateInputChange($event)" [ngModel]="filters().fromDate" type="date">
      </div>

      <div>
        to date:
        <input (ngModelChange)="onToDateInputChange($event)" [ngModel]="filters().toDate" type="date">
      </div>
    </div>

    <button (click)="clearFilters()">clear filters</button>
  </fieldset>

  @if (loading()) {
    <div style="text-align: center; padding: var(--space-unit);">
      loading rfqs...
    </div>
  }

  @if (error()) {
    <div style="border: var(--border-width) solid rgb(var(--color-accent)); padding: var(--space-unit);">
      error: {{ error() }}
    </div>
  }

  @if (!loading() && !error()) {
    <div class="data-grid">
      <ag-grid-angular [rowData]="rfqs()" [columnDefs]="columnDefs" [defaultColDef]="defaultColDef" [theme]="gridTheme"
                       [rowSelection]="'single'" [animateRows]="true" [domLayout]="'normal'"
                       (gridReady)="onGridReady($event)"
                       (rowClicked)="onRowClicked($event)" style="height: 600px; width: 100%;">
      </ag-grid-angular>
    </div>

    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: var(--space-unit);">
      <p>showing {{ (currentPage() - 1) * pageSize() + 1 }} to {{ Math.min(currentPage() * pageSize(), totalCount()) }}
        of {{ totalCount() }} results</p>
      <div>
        <button (click)="onPageChange(currentPage() - 1)" [disabled]="!hasPrevPage()">← prev</button>
        @for (page of getPageNumbers(); track page) {
          <button (click)="onPageChange(page)"
                  [style.text-decoration]="page === currentPage() ? 'underline' : 'none'">{{ page }}
          </button>
        }
        <button (click)="onPageChange(currentPage() + 1)" [disabled]="!hasNextPage()">next →</button>
      </div>
    </div>
  }
</div>
